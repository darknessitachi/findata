-- Must use UTF-8 encoding for these tables
CREATE TABLE source (
	id INT UNSIGNED AUTO_INCREMENT,
	class_name VARCHAR(255),
	PRIMARY KEY (id)
);

CREATE TABLE fin_data_updates (
  id INT UNSIGNED AUTO_INCREMENT,
  _date DATE,
  PRIMARY KEY (id)
);

INSERT INTO fin_data_updates (_date) VALUES ('2013-01-18');

CREATE TABLE fin_field (
	id INT UNSIGNED AUTO_INCREMENT,
	fin_sheet VARCHAR(255),
	name VARCHAR(255),
	PRIMARY KEY (id),
	UNIQUE (fin_sheet, name)
);

CREATE TABLE share_number_change (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	change_date DATE,
	number_of_shares BIGINT UNSIGNED,
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, change_date),
	PRIMARY KEY (id)
);

CREATE TABLE dividend (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	announcement_date DATE,
	amount FLOAT,
	bonus FLOAT,
	payment_date DATE,
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, announcement_date),
	PRIMARY KEY (id)
);

CREATE TABLE stock (
	id INT UNSIGNED AUTO_INCREMENT,
	code VARCHAR(20),
	name VARCHAR(20),
	current_price FLOAT UNSIGNED DEFAULT 0 NOT NULL,
	number_of_shares FLOAT UNSIGNED DEFAULT 0 NOT NULL,
	latest_year MEDIUMINT UNSIGNED,
	latest_season TINYINT UNSIGNED,
  is_interesting BIT DEFAULT false NOT NULL,
	is_financial BIT DEFAULT false NOT NULL,
	is_ignored BIT DEFAULT false NOT NULL,
	last_updated TIMESTAMP,
	UNIQUE (code),
	PRIMARY KEY (id)
);

CREATE TABLE report_pub_dates (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	fin_date DATE,
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	PRIMARY KEY (id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE fin_data (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	source_id INT UNSIGNED,
	fin_field_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	value DOUBLE,
	order_ INT UNSIGNED,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	FOREIGN KEY (source_id) REFERENCES source(id),
	FOREIGN KEY (fin_field_id) REFERENCES fin_field(id),
	UNIQUE (stock_id, fin_year, fin_season, source_id, fin_field_id)
);

CREATE TABLE IF NOT EXISTS stock_price (
	id BIGINT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	open INT UNSIGNED,
	high INT UNSIGNED,
	low INT UNSIGNED,
	close INT UNSIGNED,
	avg INT UNSIGNED,
	adjustment_factor FLOAT,
--	FOREIGN KEY (stock_id) REFERENCES stock(id), -- FOREIGN KEY is not yet supported with PARTITION
	PRIMARY KEY (id, date), -- have to add 'date' into PRIMARY KEY otherwise mysql wont allow partitioning
  INDEX (date),
	UNIQUE (stock_id, date)
)
PARTITION BY RANGE (UNIX_TIMESTAMP(date)) (
PARTITION p00 VALUES LESS THAN (UNIX_TIMESTAMP('1995-01-01 00:00:00')),
PARTITION p01 VALUES LESS THAN (UNIX_TIMESTAMP('1998-01-01 00:00:00')),
PARTITION p02 VALUES LESS THAN (UNIX_TIMESTAMP('1999-01-01 00:00:00')),
PARTITION p03 VALUES LESS THAN (UNIX_TIMESTAMP('2000-01-01 00:00:00')),
PARTITION p04 VALUES LESS THAN (UNIX_TIMESTAMP('2001-01-01 00:00:00')),
PARTITION p05 VALUES LESS THAN (UNIX_TIMESTAMP('2002-01-01 00:00:00')),
PARTITION p06 VALUES LESS THAN (UNIX_TIMESTAMP('2003-01-01 00:00:00')),
PARTITION p07 VALUES LESS THAN (UNIX_TIMESTAMP('2004-01-01 00:00:00')),
PARTITION p08 VALUES LESS THAN (UNIX_TIMESTAMP('2005-01-01 00:00:00')),
PARTITION p09 VALUES LESS THAN (UNIX_TIMESTAMP('2006-01-01 00:00:00')),
PARTITION p10 VALUES LESS THAN (UNIX_TIMESTAMP('2007-01-01 00:00:00')),
PARTITION p11 VALUES LESS THAN (UNIX_TIMESTAMP('2008-01-01 00:00:00')),
PARTITION p12 VALUES LESS THAN (UNIX_TIMESTAMP('2009-01-01 00:00:00')),
PARTITION p13 VALUES LESS THAN (UNIX_TIMESTAMP('2010-01-01 00:00:00')),
PARTITION p14 VALUES LESS THAN (UNIX_TIMESTAMP('2011-01-01 00:00:00')),
PARTITION p15 VALUES LESS THAN (UNIX_TIMESTAMP('2012-01-01 00:00:00')),
PARTITION p16 VALUES LESS THAN (UNIX_TIMESTAMP('2013-01-01 00:00:00')),
PARTITION p17 VALUES LESS THAN (UNIX_TIMESTAMP('2014-01-01 00:00:00')),
PARTITION p18 VALUES LESS THAN (UNIX_TIMESTAMP('2015-01-01 00:00:00')),
PARTITION p19 VALUES LESS THAN (UNIX_TIMESTAMP('2016-01-01 00:00:00')),
PARTITION p20 VALUES LESS THAN (UNIX_TIMESTAMP('2017-01-01 00:00:00')),
PARTITION p21 VALUES LESS THAN (UNIX_TIMESTAMP('2018-01-01 00:00:00')),
PARTITION p22 VALUES LESS THAN (UNIX_TIMESTAMP('2019-01-01 00:00:00')),
PARTITION p23 VALUES LESS THAN (UNIX_TIMESTAMP('2020-01-01 00:00:00')),
PARTITION p24 VALUES LESS THAN (UNIX_TIMESTAMP('2021-01-01 00:00:00')),
PARTITION p25 VALUES LESS THAN (UNIX_TIMESTAMP('2022-01-01 00:00:00')),
PARTITION p26 VALUES LESS THAN (UNIX_TIMESTAMP('2023-01-01 00:00:00')),
PARTITION p27 VALUES LESS THAN (UNIX_TIMESTAMP('2024-01-01 00:00:00')),
PARTITION p28 VALUES LESS THAN (UNIX_TIMESTAMP('2025-01-01 00:00:00')),
PARTITION p29 VALUES LESS THAN (UNIX_TIMESTAMP('2026-01-01 00:00:00')),
PARTITION p30 VALUES LESS THAN (UNIX_TIMESTAMP('2027-01-01 00:00:00')),
PARTITION p31 VALUES LESS THAN (UNIX_TIMESTAMP('2028-01-01 00:00:00')),
PARTITION p32 VALUES LESS THAN (UNIX_TIMESTAMP('2029-01-01 00:00:00')),
PARTITION p33 VALUES LESS THAN (UNIX_TIMESTAMP('2030-01-01 00:00:00')),
PARTITION p34 VALUES LESS THAN (UNIX_TIMESTAMP('2031-01-01 00:00:00')),
PARTITION p35 VALUES LESS THAN (UNIX_TIMESTAMP('2032-01-01 00:00:00')),
PARTITION p36 VALUES LESS THAN (UNIX_TIMESTAMP('2033-01-01 00:00:00')),
PARTITION p37 VALUES LESS THAN (UNIX_TIMESTAMP('2034-01-01 00:00:00')),
PARTITION p38 VALUES LESS THAN (UNIX_TIMESTAMP('2035-01-01 00:00:00')),
PARTITION p39 VALUES LESS THAN (UNIX_TIMESTAMP('2036-01-01 00:00:00')),
PARTITION p40 VALUES LESS THAN (UNIX_TIMESTAMP('2037-01-01 00:00:00')),
PARTITION p41 VALUES LESS THAN (UNIX_TIMESTAMP('2038-01-01 00:00:00')),
PARTITION p99 VALUES LESS THAN (MAXVALUE)
);

CREATE TABLE IF NOT EXISTS stock_price_minute (
	id BIGINT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	date TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
	minute_data BLOB,
	adjustment_factor FLOAT,
	PRIMARY KEY (id, date), -- have to add 'date' into PRIMARY KEY otherwise mysql wont allow partitioning
	INDEX (date),
	UNIQUE (stock_id, date)
) PARTITION BY RANGE (UNIX_TIMESTAMP(date)) (
PARTITION p00 VALUES LESS THAN (UNIX_TIMESTAMP('1995-01-01 00:00:00')),
PARTITION p01 VALUES LESS THAN (UNIX_TIMESTAMP('1998-01-01 00:00:00')),
PARTITION p02 VALUES LESS THAN (UNIX_TIMESTAMP('1999-01-01 00:00:00')),
PARTITION p03 VALUES LESS THAN (UNIX_TIMESTAMP('2000-01-01 00:00:00')),
PARTITION p04 VALUES LESS THAN (UNIX_TIMESTAMP('2001-01-01 00:00:00')),
PARTITION p05 VALUES LESS THAN (UNIX_TIMESTAMP('2002-01-01 00:00:00')),
PARTITION p06 VALUES LESS THAN (UNIX_TIMESTAMP('2003-01-01 00:00:00')),
PARTITION p07 VALUES LESS THAN (UNIX_TIMESTAMP('2004-01-01 00:00:00')),
PARTITION p08 VALUES LESS THAN (UNIX_TIMESTAMP('2005-01-01 00:00:00')),
PARTITION p09 VALUES LESS THAN (UNIX_TIMESTAMP('2006-01-01 00:00:00')),
PARTITION p10 VALUES LESS THAN (UNIX_TIMESTAMP('2007-01-01 00:00:00')),
PARTITION p11 VALUES LESS THAN (UNIX_TIMESTAMP('2008-01-01 00:00:00')),
PARTITION p12 VALUES LESS THAN (UNIX_TIMESTAMP('2009-01-01 00:00:00')),
PARTITION p13 VALUES LESS THAN (UNIX_TIMESTAMP('2010-01-01 00:00:00')),
PARTITION p14 VALUES LESS THAN (UNIX_TIMESTAMP('2011-01-01 00:00:00')),
PARTITION p15 VALUES LESS THAN (UNIX_TIMESTAMP('2012-01-01 00:00:00')),
PARTITION p16 VALUES LESS THAN (UNIX_TIMESTAMP('2013-01-01 00:00:00')),
PARTITION p17 VALUES LESS THAN (UNIX_TIMESTAMP('2014-01-01 00:00:00')),
PARTITION p18 VALUES LESS THAN (UNIX_TIMESTAMP('2015-01-01 00:00:00')),
PARTITION p19 VALUES LESS THAN (UNIX_TIMESTAMP('2016-01-01 00:00:00')),
PARTITION p20 VALUES LESS THAN (UNIX_TIMESTAMP('2017-01-01 00:00:00')),
PARTITION p21 VALUES LESS THAN (UNIX_TIMESTAMP('2018-01-01 00:00:00')),
PARTITION p22 VALUES LESS THAN (UNIX_TIMESTAMP('2019-01-01 00:00:00')),
PARTITION p23 VALUES LESS THAN (UNIX_TIMESTAMP('2020-01-01 00:00:00')),
PARTITION p24 VALUES LESS THAN (UNIX_TIMESTAMP('2021-01-01 00:00:00')),
PARTITION p25 VALUES LESS THAN (UNIX_TIMESTAMP('2022-01-01 00:00:00')),
PARTITION p26 VALUES LESS THAN (UNIX_TIMESTAMP('2023-01-01 00:00:00')),
PARTITION p27 VALUES LESS THAN (UNIX_TIMESTAMP('2024-01-01 00:00:00')),
PARTITION p28 VALUES LESS THAN (UNIX_TIMESTAMP('2025-01-01 00:00:00')),
PARTITION p29 VALUES LESS THAN (UNIX_TIMESTAMP('2026-01-01 00:00:00')),
PARTITION p30 VALUES LESS THAN (UNIX_TIMESTAMP('2027-01-01 00:00:00')),
PARTITION p31 VALUES LESS THAN (UNIX_TIMESTAMP('2028-01-01 00:00:00')),
PARTITION p32 VALUES LESS THAN (UNIX_TIMESTAMP('2029-01-01 00:00:00')),
PARTITION p33 VALUES LESS THAN (UNIX_TIMESTAMP('2030-01-01 00:00:00')),
PARTITION p34 VALUES LESS THAN (UNIX_TIMESTAMP('2031-01-01 00:00:00')),
PARTITION p35 VALUES LESS THAN (UNIX_TIMESTAMP('2032-01-01 00:00:00')),
PARTITION p36 VALUES LESS THAN (UNIX_TIMESTAMP('2033-01-01 00:00:00')),
PARTITION p37 VALUES LESS THAN (UNIX_TIMESTAMP('2034-01-01 00:00:00')),
PARTITION p38 VALUES LESS THAN (UNIX_TIMESTAMP('2035-01-01 00:00:00')),
PARTITION p39 VALUES LESS THAN (UNIX_TIMESTAMP('2036-01-01 00:00:00')),
PARTITION p40 VALUES LESS THAN (UNIX_TIMESTAMP('2037-01-01 00:00:00')),
PARTITION p41 VALUES LESS THAN (UNIX_TIMESTAMP('2038-01-01 00:00:00')),
PARTITION p99 VALUES LESS THAN (MAXVALUE)
);

CREATE TABLE profit_and_loss_nf (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	pl01 DOUBLE,
	pl02 DOUBLE,
	pl03 DOUBLE,
	pl04 DOUBLE,
	pl05 DOUBLE,
	pl06 DOUBLE,
	pl07 DOUBLE,
	pl08 DOUBLE,
	pl09 DOUBLE,
	pl10 DOUBLE,
	pl11 DOUBLE,
	pl12 DOUBLE,
	pl13 DOUBLE,
	pl14 DOUBLE,
	pl15 DOUBLE,
	pl16 DOUBLE,
	pl17 DOUBLE,
	pl18 DOUBLE,
	pl19 DOUBLE,
	pl20 DOUBLE,
	pl21 DOUBLE,
	pl22 DOUBLE,
	pl23 DOUBLE,
	pl24 DOUBLE,
	pl25 DOUBLE,
	pl26 DOUBLE,
	pl27 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE profit_and_loss_f (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	pl01 DOUBLE,
	pl02 DOUBLE,
	pl03 DOUBLE,
	pl04 DOUBLE,
	pl05 DOUBLE,
	pl06 DOUBLE,
	pl07 DOUBLE,
	pl08 DOUBLE,
	pl09 DOUBLE,
	pl10 DOUBLE,
	pl11 DOUBLE,
	pl12 DOUBLE,
	pl13 DOUBLE,
	pl14 DOUBLE,
	pl15 DOUBLE,
	pl16 DOUBLE,
	pl17 DOUBLE,
	pl18 DOUBLE,
	pl19 DOUBLE,
	pl20 DOUBLE,
	pl21 DOUBLE,
	pl22 DOUBLE,
	pl23 DOUBLE,
	pl24 DOUBLE,
	pl25 DOUBLE,
	pl26 DOUBLE,
	pl27 DOUBLE,
	pl28 DOUBLE,
	pl29 DOUBLE,
	pl30 DOUBLE,
	pl31 DOUBLE,
	pl32 DOUBLE,
	pl33 DOUBLE,
	pl34 DOUBLE,
	pl35 DOUBLE,
	pl36 DOUBLE,
	pl37 DOUBLE,
	pl38 DOUBLE,
	pl39 DOUBLE,
	pl40 DOUBLE,
	pl41 DOUBLE,
	pl42 DOUBLE,
	pl43 DOUBLE,
	pl44 DOUBLE,
	pl45 DOUBLE,
	pl46 DOUBLE,
	pl47 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE balance_sheet_nf (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	bs01 DOUBLE,
	bs02 DOUBLE,
	bs03 DOUBLE,
	bs04 DOUBLE,
	bs05 DOUBLE,
	bs06 DOUBLE,
	bs07 DOUBLE,
	bs08 DOUBLE,
	bs09 DOUBLE,
	bs10 DOUBLE,
	bs11 DOUBLE,
	bs12 DOUBLE,
	bs13 DOUBLE,
	bs14 DOUBLE,
	bs15 DOUBLE,
	bs16 DOUBLE,
	bs17 DOUBLE,
	bs18 DOUBLE,
	bs19 DOUBLE,
	bs20 DOUBLE,
	bs21 DOUBLE,
	bs22 DOUBLE,
	bs23 DOUBLE,
	bs24 DOUBLE,
	bs25 DOUBLE,
	bs26 DOUBLE,
	bs27 DOUBLE,
	bs28 DOUBLE,
	bs29 DOUBLE,
	bs30 DOUBLE,
	bs31 DOUBLE,
	bs32 DOUBLE,
	bs33 DOUBLE,
	bs34 DOUBLE,
	bs35 DOUBLE,
	bs36 DOUBLE,
	bs37 DOUBLE,
	bs38 DOUBLE,
	bs39 DOUBLE,
	bs40 DOUBLE,
	bs41 DOUBLE,
	bs42 DOUBLE,
	bs43 DOUBLE,
	bs44 DOUBLE,
	bs45 DOUBLE,
	bs46 DOUBLE,
	bs47 DOUBLE,
	bs48 DOUBLE,
	bs49 DOUBLE,
	bs50 DOUBLE,
	bs51 DOUBLE,
	bs52 DOUBLE,
	bs53 DOUBLE,
	bs54 DOUBLE,
	bs55 DOUBLE,
	bs56 DOUBLE,
	bs57 DOUBLE,
	bs58 DOUBLE,
	bs59 DOUBLE,
	bs60 DOUBLE,
	bs61 DOUBLE,
	bs62 DOUBLE,
	bs63 DOUBLE,
	bs64 DOUBLE,
	bs65 DOUBLE,
	bs66 DOUBLE,
	bs67 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE balance_sheet_f (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	bs01 DOUBLE,
	bs02 DOUBLE,
	bs03 DOUBLE,
	bs04 DOUBLE,
	bs05 DOUBLE,
	bs06 DOUBLE,
	bs07 DOUBLE,
	bs08 DOUBLE,
	bs09 DOUBLE,
	bs10 DOUBLE,
	bs11 DOUBLE,
	bs12 DOUBLE,
	bs13 DOUBLE,
	bs14 DOUBLE,
	bs15 DOUBLE,
	bs16 DOUBLE,
	bs17 DOUBLE,
	bs18 DOUBLE,
	bs19 DOUBLE,
	bs20 DOUBLE,
	bs21 DOUBLE,
	bs22 DOUBLE,
	bs23 DOUBLE,
	bs24 DOUBLE,
	bs25 DOUBLE,
	bs26 DOUBLE,
	bs27 DOUBLE,
	bs28 DOUBLE,
	bs29 DOUBLE,
	bs30 DOUBLE,
	bs31 DOUBLE,
	bs32 DOUBLE,
	bs33 DOUBLE,
	bs34 DOUBLE,
	bs35 DOUBLE,
	bs36 DOUBLE,
	bs37 DOUBLE,
	bs38 DOUBLE,
	bs39 DOUBLE,
	bs40 DOUBLE,
	bs41 DOUBLE,
	bs42 DOUBLE,
	bs43 DOUBLE,
	bs44 DOUBLE,
	bs45 DOUBLE,
	bs46 DOUBLE,
	bs47 DOUBLE,
	bs48 DOUBLE,
	bs49 DOUBLE,
	bs50 DOUBLE,
	bs51 DOUBLE,
	bs52 DOUBLE,
	bs53 DOUBLE,
	bs54 DOUBLE,
	bs55 DOUBLE,
	bs56 DOUBLE,
	bs57 DOUBLE,
	bs58 DOUBLE,
	bs59 DOUBLE,
	bs60 DOUBLE,
	bs61 DOUBLE,
	bs62 DOUBLE,
	bs63 DOUBLE,
	bs64 DOUBLE,
	bs65 DOUBLE,
	bs66 DOUBLE,
	bs67 DOUBLE,
	bs68 DOUBLE,
	bs69 DOUBLE,
	bs70 DOUBLE,
	bs71 DOUBLE,
	bs72 DOUBLE,
	bs73 DOUBLE,
	bs74 DOUBLE,
	bs75 DOUBLE,
	bs76 DOUBLE,
	bs77 DOUBLE,
	bs78 DOUBLE,
	bs79 DOUBLE,
	bs80 DOUBLE,
	bs81 DOUBLE,
	bs82 DOUBLE,
	bs83 DOUBLE,
	bs84 DOUBLE,
	bs85 DOUBLE,
	bs86 DOUBLE,
	bs87 DOUBLE,
	bs88 DOUBLE,
	bs89 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE cash_flow_nf (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	cf01 DOUBLE,
	cf02 DOUBLE,
	cf03 DOUBLE,
	cf04 DOUBLE,
	cf05 DOUBLE,
	cf06 DOUBLE,
	cf07 DOUBLE,
	cf08 DOUBLE,
	cf09 DOUBLE,
	cf10 DOUBLE,
	cf11 DOUBLE,
	cf12 DOUBLE,
	cf13 DOUBLE,
	cf14 DOUBLE,
	cf15 DOUBLE,
	cf16 DOUBLE,
	cf17 DOUBLE,
	cf18 DOUBLE,
	cf19 DOUBLE,
	cf20 DOUBLE,
	cf21 DOUBLE,
	cf22 DOUBLE,
	cf23 DOUBLE,
	cf24 DOUBLE,
	cf25 DOUBLE,
	cf26 DOUBLE,
	cf27 DOUBLE,
	cf28 DOUBLE,
	cf29 DOUBLE,
	cf30 DOUBLE,
	cf31 DOUBLE,
	cf32 DOUBLE,
	cf33 DOUBLE,
	cf34 DOUBLE,
	cf35 DOUBLE,
	cf36 DOUBLE,
	cf37 DOUBLE,
	cf38 DOUBLE,
	cf39 DOUBLE,
	cf40 DOUBLE,
	cf41 DOUBLE,
	cf42 DOUBLE,
	cf43 DOUBLE,
	cf44 DOUBLE,
	cf45 DOUBLE,
	cf46 DOUBLE,
	cf47 DOUBLE,
	cf48 DOUBLE,
	cf49 DOUBLE,
	cf50 DOUBLE,
	cf51 DOUBLE,
	cf52 DOUBLE,
	cf53 DOUBLE,
	cf54 DOUBLE,
	cf55 DOUBLE,
	cf56 DOUBLE,
	cf57 DOUBLE,
	cf58 DOUBLE,
	cf59 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE cash_flow_f (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	cf01 DOUBLE,
	cf02 DOUBLE,
	cf03 DOUBLE,
	cf04 DOUBLE,
	cf05 DOUBLE,
	cf06 DOUBLE,
	cf07 DOUBLE,
	cf08 DOUBLE,
	cf09 DOUBLE,
	cf10 DOUBLE,
	cf11 DOUBLE,
	cf12 DOUBLE,
	cf13 DOUBLE,
	cf14 DOUBLE,
	cf15 DOUBLE,
	cf16 DOUBLE,
	cf17 DOUBLE,
	cf18 DOUBLE,
	cf19 DOUBLE,
	cf20 DOUBLE,
	cf21 DOUBLE,
	cf22 DOUBLE,
	cf23 DOUBLE,
	cf24 DOUBLE,
	cf25 DOUBLE,
	cf26 DOUBLE,
	cf27 DOUBLE,
	cf28 DOUBLE,
	cf29 DOUBLE,
	cf30 DOUBLE,
	cf31 DOUBLE,
	cf32 DOUBLE,
	cf33 DOUBLE,
	cf34 DOUBLE,
	cf35 DOUBLE,
	cf36 DOUBLE,
	cf37 DOUBLE,
	cf38 DOUBLE,
	cf39 DOUBLE,
	cf40 DOUBLE,
	cf41 DOUBLE,
	cf42 DOUBLE,
	cf43 DOUBLE,
	cf44 DOUBLE,
	cf45 DOUBLE,
	cf46 DOUBLE,
	cf47 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE provision (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	pv01 DOUBLE,
	pv02 DOUBLE,
	pv03 DOUBLE,
	pv04 DOUBLE,
	pv05 DOUBLE,
	pv06 DOUBLE,
	pv07 DOUBLE,
	pv08 DOUBLE,
	pv09 DOUBLE,
	pv10 DOUBLE,
	pv11 DOUBLE,
	pv12 DOUBLE,
	pv13 DOUBLE,
	pv14 DOUBLE,
	pv15 DOUBLE,
	pv16 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE profit_and_loss_single_season_nf (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	pl01 DOUBLE,
	pl02 DOUBLE,
	pl03 DOUBLE,
	pl04 DOUBLE,
	pl05 DOUBLE,
	pl06 DOUBLE,
	pl07 DOUBLE,
	pl08 DOUBLE,
	pl09 DOUBLE,
	pl10 DOUBLE,
	pl11 DOUBLE,
	pl12 DOUBLE,
	pl13 DOUBLE,
	pl14 DOUBLE,
	pl15 DOUBLE,
	pl16 DOUBLE,
	pl17 DOUBLE,
	pl18 DOUBLE,
	pl19 DOUBLE,
	pl20 DOUBLE,
	pl21 DOUBLE,
	pl22 DOUBLE,
	pl23 DOUBLE,
	pl24 DOUBLE,
	pl25 DOUBLE,
	pl26 DOUBLE,
	pl27 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE profit_and_loss_single_season_f (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	pl01 DOUBLE,
	pl02 DOUBLE,
	pl03 DOUBLE,
	pl04 DOUBLE,
	pl05 DOUBLE,
	pl06 DOUBLE,
	pl07 DOUBLE,
	pl08 DOUBLE,
	pl09 DOUBLE,
	pl10 DOUBLE,
	pl11 DOUBLE,
	pl12 DOUBLE,
	pl13 DOUBLE,
	pl14 DOUBLE,
	pl15 DOUBLE,
	pl16 DOUBLE,
	pl17 DOUBLE,
	pl18 DOUBLE,
	pl19 DOUBLE,
	pl20 DOUBLE,
	pl21 DOUBLE,
	pl22 DOUBLE,
	pl23 DOUBLE,
	pl24 DOUBLE,
	pl25 DOUBLE,
	pl26 DOUBLE,
	pl27 DOUBLE,
	pl28 DOUBLE,
	pl29 DOUBLE,
	pl30 DOUBLE,
	pl31 DOUBLE,
	pl32 DOUBLE,
	pl33 DOUBLE,
	pl34 DOUBLE,
	pl35 DOUBLE,
	pl36 DOUBLE,
	pl37 DOUBLE,
	pl38 DOUBLE,
	pl39 DOUBLE,
	pl40 DOUBLE,
	pl41 DOUBLE,
	pl42 DOUBLE,
	pl43 DOUBLE,
	pl44 DOUBLE,
	pl45 DOUBLE,
	pl46 DOUBLE,
	pl47 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE cash_flow_single_season_nf (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	cf01 DOUBLE,
	cf02 DOUBLE,
	cf03 DOUBLE,
	cf04 DOUBLE,
	cf05 DOUBLE,
	cf06 DOUBLE,
	cf07 DOUBLE,
	cf08 DOUBLE,
	cf09 DOUBLE,
	cf10 DOUBLE,
	cf11 DOUBLE,
	cf12 DOUBLE,
	cf13 DOUBLE,
	cf14 DOUBLE,
	cf15 DOUBLE,
	cf16 DOUBLE,
	cf17 DOUBLE,
	cf18 DOUBLE,
	cf19 DOUBLE,
	cf20 DOUBLE,
	cf21 DOUBLE,
	cf22 DOUBLE,
	cf23 DOUBLE,
	cf24 DOUBLE,
	cf25 DOUBLE,
	cf26 DOUBLE,
	cf27 DOUBLE,
	cf28 DOUBLE,
	cf29 DOUBLE,
	cf30 DOUBLE,
	cf31 DOUBLE,
	cf32 DOUBLE,
	cf33 DOUBLE,
	cf34 DOUBLE,
	cf35 DOUBLE,
	cf36 DOUBLE,
	cf37 DOUBLE,
	cf38 DOUBLE,
	cf39 DOUBLE,
	cf40 DOUBLE,
	cf41 DOUBLE,
	cf42 DOUBLE,
	cf43 DOUBLE,
	cf44 DOUBLE,
	cf45 DOUBLE,
	cf46 DOUBLE,
	cf47 DOUBLE,
	cf48 DOUBLE,
	cf49 DOUBLE,
	cf50 DOUBLE,
	cf51 DOUBLE,
	cf52 DOUBLE,
	cf53 DOUBLE,
	cf54 DOUBLE,
	cf55 DOUBLE,
	cf56 DOUBLE,
	cf57 DOUBLE,
	cf58 DOUBLE,
	cf59 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

CREATE TABLE cash_flow_single_season_f (
	id INT UNSIGNED AUTO_INCREMENT,
	stock_id INT UNSIGNED,
	fin_year MEDIUMINT UNSIGNED,
	fin_season TINYINT UNSIGNED,
	cf01 DOUBLE,
	cf02 DOUBLE,
	cf03 DOUBLE,
	cf04 DOUBLE,
	cf05 DOUBLE,
	cf06 DOUBLE,
	cf07 DOUBLE,
	cf08 DOUBLE,
	cf09 DOUBLE,
	cf10 DOUBLE,
	cf11 DOUBLE,
	cf12 DOUBLE,
	cf13 DOUBLE,
	cf14 DOUBLE,
	cf15 DOUBLE,
	cf16 DOUBLE,
	cf17 DOUBLE,
	cf18 DOUBLE,
	cf19 DOUBLE,
	cf20 DOUBLE,
	cf21 DOUBLE,
	cf22 DOUBLE,
	cf23 DOUBLE,
	cf24 DOUBLE,
	cf25 DOUBLE,
	cf26 DOUBLE,
	cf27 DOUBLE,
	cf28 DOUBLE,
	cf29 DOUBLE,
	cf30 DOUBLE,
	cf31 DOUBLE,
	cf32 DOUBLE,
	cf33 DOUBLE,
	cf34 DOUBLE,
	cf35 DOUBLE,
	cf36 DOUBLE,
	cf37 DOUBLE,
	cf38 DOUBLE,
	cf39 DOUBLE,
	cf40 DOUBLE,
	cf41 DOUBLE,
	cf42 DOUBLE,
	cf43 DOUBLE,
	cf44 DOUBLE,
	cf45 DOUBLE,
	cf46 DOUBLE,
	cf47 DOUBLE,
	PRIMARY KEY (id),
	FOREIGN KEY (stock_id) REFERENCES stock(id),
	UNIQUE (stock_id, fin_year, fin_season)
);

INSERT INTO analysis_field (name, description) VALUES ('Seasonal GI', 'Gross Income of a single season');
INSERT INTO analysis_field (name, description) VALUES ('Seasonal GI YonY Growth', 'Single-season gross income"s year-on-year growth');
INSERT INTO analysis_field (name, description) VALUES ('Seasonal GI SoS Growth', 'Single-season gross income"s season-on-season growth');
INSERT INTO analysis_field (name, description) VALUES ('Y2D GI YoY Growth', 'Year-to-date gross income"s year-on-year growth');
INSERT INTO analysis_field (name, description) VALUES ('Seasonal OC', 'Operating cost of a single season');
INSERT INTO analysis_field (name, description) VALUES ('Y2D PM', 'Year-to-date profit margin');
INSERT INTO analysis_field (name, description) VALUES ('Seasonal PM', 'Single-season profit margin');
INSERT INTO analysis_field (name, description) VALUES ('Seasonal PM SoS Delta', 'Season-on-season delta of single-season profit margin');

-- INSERT INTO fin_sheet (name) VALUES ('balance');
-- INSERT INTO fin_sheet (name) VALUES ('profit&loss');
-- INSERT INTO fin_sheet (name) VALUES ('cashflow');

-- INSERT INTO fin_period (name, annual) VALUE ('1992.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('1993.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('1994.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('1995.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('1996.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('1997.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('1998.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('1999.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2000.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2001.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2002.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2003.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2004.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2005.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2006.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2007.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2008.12', true);
-- INSERT INTO fin_period (name, annual) VALUE ('2009.12', true);

-- INSERT INTO fin_period (name, annual) VALUE ('2010.03', false);
-- INSERT INTO fin_period (name, annual) VALUE ('2010.06', false);
-- INSERT INTO fin_period (name, annual) VALUE ('2010.09', false);
-- INSERT INTO fin_period (name, annual) VALUE ('2010.12', true);

-- INSERT INTO source (name, url) VALUES ('hexun2008', 'http://stockdata.stock.hexun.com/2008/[fin_sheet].aspx?stockid=[stock]&accountdate=[fin_period]');
-- INSERT INTO source_fin_sheet (source_id, fin_sheet_id, text_pattern) VALUES (1,1, 'zcfz');
-- INSERT INTO source_fin_sheet (source_id, fin_sheet_id, text_pattern) VALUES (1,2, 'lr');
-- INSERT INTO source_fin_sheet (source_id, fin_sheet_id, text_pattern) VALUES (1,3, 'xjll');
select name, code, fin_year, c from stock s, (select count(*) c, stock_id, fin_year from report_pub_dates group by stock_id, fin_year having (fin_year >= 2002 and fin_year < 2012 and c < 4)) cnt where cnt.stock_id = s.id order by code, fin_year;

select name, code, fin_year, c from stock s, (select count(*) c, stock_id, fin_year from report_pub_dates group by stock_id, fin_year having (fin_year < 2002 and c < 2)) cnt where cnt.stock_id = s.id order by code, fin_year;